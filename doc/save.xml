	<sect1 xml:id="ttype_outlier">
		<title>Outlier detection</title>
		<itemizedlist>
			<listitem xml:id="geo_wlof">
				<indexterm significance="normal"><primary><varname>localOutlierFactor</varname></primary></indexterm>
				<para>Return the weighted local outlier factor (WLOF) of an array of geometries. The <ulink url="https://en.wikipedia.org/wiki/Local_outlier_factor">Local Outlier Factor</ulink> is commonly used for finding anomalous data points by measuring the local density of a given data point with respect to its neighbors, for example, in <ulink url="https://scikit-learn.org/stable/auto_examples/neighbors/plot_lof_outlier_detection.html">scikit-learn</ulink>. When there are duplicates in the data points, the Weighted Local Outlier Factor (WLOF) algorithm can be used, as implemented for example in <ulink url="https://www.mathworks.com/help/stats/lof.html">Matlab</ulink>. In these algorithms, the local density of a data point is given by its <emphasis>k</emphasis> nearest neighbors, whose distance is used to estimate the density.</para>
				<para><varname>localOutlierFactor(geo[],k integer) â†’ float[]</varname></para>
				<programlisting language="sql" xml:space="preserve">
WITH Points(Id, Geom) AS (
  SELECT 'A', ST_Makepoint(7,6) UNION
  SELECT 'B', ST_Makepoint(1,5) UNION
  SELECT 'C', ST_Makepoint(1,4) UNION
  SELECT 'D', ST_Makepoint(4,1) UNION
  SELECT 'E', ST_Makepoint(3,1) UNION
  SELECT 'F', ST_Makepoint(3,0) UNION
  SELECT 'G', ST_Makepoint(4,0) UNION
  -- Duplicate points so the distance to all their K nearest neighbors is 0
  SELECT 'H', ST_Makepoint(5,5) UNION
  SELECT 'I', ST_Makepoint(5,5) UNION
  SELECT 'J', ST_Makepoint(5,5) UNION
  SELECT 'K', ST_Makepoint(5,5) ),
OrderedPoints(No, Id, Geom) AS (
  SELECT ROW_NUMBER() OVER (ORDER BY Id), Id, Geom FROM Points ),
PointArray(Geoms) AS (
  SELECT array_agg(Geom ORDER BY Id) FROM Points )
SELECT P.Id, T.Geom
FROM PointArray A, OrderedPoints P,
  unnest(wlocalOutlierFactor(A.Geoms, 3)) WITH ORDINALITY AS t(Geom, No)
WHERE P.No = T.No;
/* A  | 1.81604101958325604888
   B  | 1.61086601403426790826
   C  | 1.57079940333593610931
   D  | 1.00000000000000000000
   E  | 1.00000000000000000000
   F  | 1.00000000000000000000
   G  | 1.00000000000000000000
   H  | 1.88792391880422203884
   I  | 1.88792391880422203884
   J  | 1.88792391880422203884
   K  | 1.88792391880422203884 */
</programlisting>
				<para>
					<xref linkend="wlof" /> illustrates the example points to which the <varname>wlocalOutlierFactor</varname> function is applied in the preceding query. 
				</para>
				<figure xml:id="wlof" float="start">
					<title>Example of points for estimating the weighted local outlier factor.</title>
					<mediaobject>
						<imageobject role="html"><imagedata format="SVG" fileref='../images/wlof.svg'/></imageobject>
						<imageobject role="dblatex"><imagedata scale='75' format="PDF" fileref='../images/wlof.pdf'/></imageobject>
						<imageobject role="dbtoepub"><imagedata scale='75' format="PDF" fileref='../images/wlof.pdf'/></imageobject>
					</mediaobject>
				</figure>
			</listitem>
		</itemizedlist>
	</sect1>

