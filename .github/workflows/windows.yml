name: Build for Windows

on:
  push:
    branches: [ main develop ]
  pull_request:
    branches: [ main develop ]
  workflow_dispatch:

jobs:
  build:
    name: windows
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: 'Setup'
        uses: msys2/setup-msys2@v2
        with:
          install: >-
            mingw-w64-ucrt-x86_64-gcc
            mingw-w64-ucrt-x86_64-cmake
            mingw-w64-ucrt-x86_64-make
            mingw-w64-ucrt-x86_64-postgresql
            mingw-w64-ucrt-x86_64-postgis
            mingw-w64-ucrt-x86_64-gsl
          update: true

      - name: Add msbuild to PATH
        uses: microsoft/setup-msbuild@v1.3.1

      - name: Configure
        run: |
          mkdir build
          cd build
          cmake -G"Visual Studio 17 2022" -DCMAKE_BUILD_TYPE=Release ..

      - name: build
        run: |
          cd build
          msbuild MOBILITYDB.sln /target:Build /property:Configuration=Release
