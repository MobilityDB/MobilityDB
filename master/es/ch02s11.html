<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Agregaciones</title><link rel="stylesheet" type="text/css" href="docbook.css"><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><link rel="home" href="index.html" title="MobilityDB 1.1 Manual de usuario"><link rel="up" href="ch02.html" title="Capítulo 2. Tipos de conjunto y de rango"><link rel="prev" href="ch02s10.html" title="Comparaciones"><link rel="next" href="ch02s12.html" title="Indexación"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Agregaciones</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch02s10.html">Anterior</a> </td><th width="60%" align="center">Capítulo 2. Tipos de conjunto y de rango</th><td width="20%" align="right"> <a accesskey="n" href="ch02s12.html">Siguiente</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setspan_agg"></a>Agregaciones</h2></div></div></div><p>Hay varias funciones agregadas definidas para los tipos de conjunto y de rango. Estas se describen a continuación.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>La función <code class="varname">extent</code> devuelve el rango o período delimitador que engloba un conjunto de valores de rango o de tiempo.</p></li><li class="listitem"><p>La unión es una operación muy útil para los tipos de conjunto y de rango. Como hemos visto en la <a class="xref" href="ch02s07.html" title="Operaciones de conjuntos">“Operaciones de conjuntos”</a>, podemos calcular la unión de dos valores de conjunto o de rango usando el operador <code class="varname">+</code>. Sin embargo, también es muy útil tener una versión agregada del operador de unión para combinar un número arbitrario de valores. Las funciones <code class="varname">set_union</code> y <code class="varname">span_union</code> se pueden utilizar para este propósito.</p></li><li class="listitem"><p>La función <code class="varname">tCount</code> generaliza la función de agregación tradicional <code class="varname">count</code>. El conteo temporal se puede utilizar para calcular en cada momento el número de objetos disponibles (por ejemplo, el número of períodos). La función <code class="varname">tCount</code> devuelve un entero temporal (ver el <a class="xref" href="ch04.html" title="Capítulo 4. Tipos temporales">Capítulo 4, <i>Tipos temporales</i></a>). La función tiene dos parámetros opcionales que especifican la granularidad (un <code class="varname">interval</code>) y el origen del tiempo (un <code class="varname">timestamptz</code>). Cuando se dan estos parámetros, el conteo temporal se calcula en rangos de tiempo de la granularidad dada (ver <a class="xref" href="ch09s04.html" title="Mosaicos multidimensionales">“Mosaicos multidimensionales”</a>)</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a name="setspan_extent"></a><a class="indexterm" name="idm1468"></a><p>Rango o período delimitador</p><p><code class="varname">extent({set,spans}) → span</code></p><pre class="programlisting">
WITH spans(r) AS (
  SELECT floatspan '[1, 4)' UNION
  SELECT floatspan '(5, 8)' UNION
  SELECT floatspan '(7, 9)'
)
SELECT extent(r) FROM spans;
-- [1,9)
WITH times(ts) AS (
  SELECT tstzset '{2001-01-01, 2001-01-03, 2001-01-05}' UNION
  SELECT tstzset '{2001-01-02, 2001-01-04, 2001-01-06}' UNION
  SELECT tstzset '{2001-01-01, 2001-01-02}'
)
SELECT extent(ts) FROM times;
-- [2001-01-01, 2001-01-06]
WITH periods(ps) AS (
  SELECT tstzspanset '{[2001-01-01, 2001-01-02], [2001-01-03, 2001-01-04]}' UNION
  SELECT tstzspanset '{[2001-01-01, 2001-01-04], [2001-01-05, 2001-01-06]}' UNION
  SELECT tstzspanset '{[2001-01-02, 2001-01-06]}'
)
SELECT extent(ps) FROM periods;
-- [2001-01-01, 2001-01-06]
</pre></li><li class="listitem"><a name="setspan_union_agg"></a><a class="indexterm" name="idm1476"></a><a class="indexterm" name="idm1479"></a><p>Unión agregada</p><p><code class="varname">setUnion({value,set}) → set</code></p><p><code class="varname">spanUnion(spans) → spanset</code></p><pre class="programlisting">
WITH times(ts) AS (
  SELECT tstzset '{2001-01-01, 2001-01-03, 2001-01-05}' UNION
  SELECT tstzset '{2001-01-02, 2001-01-04, 2001-01-06}' UNION
  SELECT tstzset '{2001-01-01, 2001-01-02}'
)
SELECT setUnion(ts) FROM times;
-- {2001-01-01, 2001-01-02, 2001-01-03, 2001-01-04, 2001-01-05, 2001-01-06}
WITH periods(ps) AS (
  SELECT tstzspanset '{[2001-01-01, 2001-01-02], [2001-01-03, 2001-01-04]}' UNION
  SELECT tstzspanset '{[2001-01-02, 2001-01-03], [2001-01-05, 2001-01-06]}' UNION
  SELECT tstzspanset '{[2001-01-07, 2001-01-08]}'
)
SELECT spanUnion(ps) FROM periods;
-- {[2001-01-01, 2001-01-04], [2001-01-05, 2001-01-06], [2001-01-07, 2001-01-08]}
</pre></li><li class="listitem"><a name="setspan_tCount"></a><a class="indexterm" name="idm1489"></a><p>Conteo temporal</p><p><code class="varname">tCount(times) → {tintSeq,tintSeqSet}</code></p><pre class="programlisting">
WITH times(ts) AS (
  SELECT tstzset '{2001-01-01, 2001-01-03, 2001-01-05}' UNION
  SELECT tstzset '{2001-01-02, 2001-01-04, 2001-01-06}' UNION
  SELECT tstzset '{2001-01-01, 2001-01-02}'
)
SELECT tCount(ts) FROM times;
-- {2@2001-01-01, 2@2001-01-02, 1@2001-01-03, 1@2001-01-04, 1@2001-01-05, 1@2001-01-06}
WITH periods(ps) AS (
  SELECT tstzspanset '{[2001-01-01, 2001-01-02), [2001-01-03, 2001-01-04)}' UNION
  SELECT tstzspanset '{[2001-01-01, 2001-01-04), [2001-01-05, 2001-01-06)}' UNION
  SELECT tstzspanset '{[2001-01-02, 2001-01-06)}'
)
SELECT tCount(ps) FROM periods;
-- {[2@2001-01-01, 3@2001-01-03, 1@2001-01-04, 2@2001-01-05, 2@2001-01-06)}
</pre></li></ul></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch02s10.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="ch02.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="ch02s12.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Comparaciones </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> Indexación</td></tr></table></div></body></html>
