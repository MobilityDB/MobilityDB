<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Indexación</title><link rel="stylesheet" type="text/css" href="docbook.css"><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><link rel="home" href="index.html" title="MobilityDB 1.3 Manual de usuario"><link rel="up" href="ch10.html" title="Capítulo 10. Tipos temporales: Agregación e indexación"><link rel="prev" href="ch10.html" title="Capítulo 10. Tipos temporales: Agregación e indexación"><link rel="next" href="ch10s03.html" title="Estadísticas y selectividad"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Indexación</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch10.html">Anterior</a> </td><th width="60%" align="center">Capítulo 10. Tipos temporales: Agregación e indexación</th><td width="20%" align="right"> <a accesskey="n" href="ch10s03.html">Siguiente</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="temporal_types_indexing"></a>Indexación</h2></div></div></div><p>Se pueden crear índices GiST y SP-GiST para columnas de tabla de tipos temporales. El índice GiST implementa un árbol R, mientras que el índice SP-GiST implementa un árbol cuádruple n-dimensional. Ejemplos de creación de índices son los siguientes:
			</p><pre class="programlisting">
CREATE INDEX Department_NoEmps_Gist_Idx ON Department USING Gist(NoEmps);
CREATE INDEX Trips_Trip_SPGist_Idx ON Trips USING SPGist(Trip);
</pre><p>
		</p><p>Los índices GiST y SP-GiST almacenan el cuadro delimitador para los tipos temporales. Como se explica en el <a class="xref" href="ch04.html" title="Capítulo 4. Tipos temporales">Capítulo 4, <i>Tipos temporales</i></a>, estos son
			</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>el tipo <code class="varname">tstzspan</code> para los tipos <code class="varname">tbool</code> y <code class="varname">ttext</code>,</p></li><li class="listitem"><p>el tipo <code class="varname">tbox</code> par los tipos <code class="varname">tint</code> y <code class="varname">tfloat</code>,</p></li><li class="listitem"><p>el tipo <code class="varname">stbox</code> para los tipos <code class="varname">tgeompoint</code> y <code class="varname">tgeogpoint</code>.</p></li></ul></div><p>
		</p><p>Un índice GiST o SP-GiST puede acelerar las consultas que involucran a los siguientes operadores (consulte la <a class="xref" href="ch06s04.html" title="Operadores de cuadro delimitador">“Operadores de cuadro delimitador”</a> para obtener más información):
			</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">&lt;&lt;</code>, <code class="varname">&amp;&lt;</code>, <code class="varname">&amp;&gt;</code>, <code class="varname">&gt;&gt;</code>, que sólo consideran la dimensión de valores en tipos alfanuméricos temporales,</p></li><li class="listitem"><p><code class="varname">&lt;&lt;</code>, <code class="varname">&amp;&lt;</code>, <code class="varname">&amp;&gt;</code>, <code class="varname">&gt;&gt;</code>, <code class="varname">&lt;&lt;|</code>, <code class="varname">&amp;&lt;|</code>, <code class="varname">|&amp;&gt;</code>, <code class="varname">|&gt;&gt;</code>, <code class="varname">&amp;&lt;/</code>, <code class="varname">&lt;&lt;/</code>, <code class="varname">/&gt;&gt;</code> y <code class="varname">/&amp;&gt;</code>, que sólo consideran la dimensión espacial en tipos de puntos temporales,</p></li><li class="listitem"><p><code class="varname">&amp;&lt;#</code>, <code class="varname">&lt;&lt;#</code>, <code class="varname">#&gt;&gt;</code>, <code class="varname">#&amp;&gt;</code>, que sólo consideran la dimensión temporal para todos los tipos temporales,</p></li><li class="listitem"><p><code class="varname">&amp;&amp;</code>, <code class="varname">@&gt;</code>, <code class="varname">&lt;@</code>, <code class="varname">~=</code> y <code class="varname">|=|</code>, que consideran tantas dimensiones como compartan la columna indexada y el argumento de consulta. Estos operadores trabajan en cuadros delimitadores (es decir, <code class="varname">tstzspan</code>, <code class="varname">tbox</code> o <code class="varname">stbox</code>), no los valores completos.</p></li></ul></div><p>
		</p><p>Por ejemplo, dado el índice definido anteriormente en la tabla <code class="varname">Department</code> y una consulta que implica una condición con el operador <code class="varname">&amp;&amp;</code> (superposición), si el argumento derecho es un flotante temporal, entonces se consideran tanto el valor como las dimensiones de tiempo para filtrar las tuplas de la relación, mientras que si el argumento derecho es un valor flotante, un rango flotante o un tipo de tiempo, entonces el valor o la dimensión de tiempo se utilizará para filtrar las tuplas de la relación. Además, se puede construir un cuadro delimitador a partir de un valor/rango y/o una marca de tiempo/período, que se puede usar para filtrar las tuplas de la relación. Ejemplos de consultas que utilizan el índice en la tabla <code class="varname">Department</code> definida anteriormente se dan a continuación.
			</p><pre class="programlisting">
SELECT * FROM Department WHERE NoEmps &amp;&amp; intspan '[1, 5)';
SELECT * FROM Department WHERE NoEmps &amp;&amp; tstzspan '[2001-04-01, 2001-05-01)';
SELECT * FROM Department WHERE NoEmps &amp;&amp;
  tbox(intspan '[1, 5)', tstzspan '[2001-04-01, 2001-05-01)');
SELECT * FROM Department WHERE NoEmps &amp;&amp;
  tfloat '{[1@2001-01-01, 1@2001-02-01), [5@2001-04-01, 5@2001-05-01)}';
</pre><p>
		</p><p>Del mismo modo, los ejemplos de consultas que utilizan el índice en la tabla <code class="varname">Trips</code> definida anteriormente se dan a continuación.
			</p><pre class="programlisting">
SELECT * FROM Trips WHERE Trip &amp;&amp; geometry 'Polygon((0 0,0 1,1 1,1 0,0 0))';
SELECT * FROM Trips WHERE Trip &amp;&amp; timestamptz '2001-01-01';
SELECT * FROM Trips WHERE Trip &amp;&amp; tstzspan '[2001-01-01, 2001-01-05)';
SELECT * FROM Trips WHERE Trip &amp;&amp;
  stbox(geometry 'Polygon((0 0,0 1,1 1,1 0,0 0))', tstzspan '[2001-01-01, 2001-01-05]');
SELECT * FROM Trips WHERE Trip &amp;&amp;
  tgeompoint '{[Point(0 0)@2001-01-01, Point(1 1)@2001-01-02, Point(1 1)@2001-01-05)}';
</pre><p>
		</p><p>Finalmente, se pueden crear índices de árbol B para columnas de tabla de todos los tipos temporales. Para este tipo de índice, la única operación útil es la igualdad. Hay un orden de clasificación de árbol B definido para valores de tipos temporales, con los correspondientes operadores <code class="varname">&lt;</code>, <code class="varname">&lt;=</code>, <code class="varname">&gt;</code> y <code class="varname">&gt;=</code>, pero el orden es bastante arbitrario y no suele ser útil en el mundo real. El soporte de árbol B para tipos temporales está destinado principalmente a permitir la clasificación interna en las consultas, en lugar de la creación de índices reales.</p><p>Para acelerar algunas de las funciones de los tipos temporales, se puede agregar en la cláusula <code class="varname">WHERE</code> de las consultas una comparación de cuadro delimitador que hace uso de los índices disponibles. Por ejemplo, este sería típicamente el caso de las funciones que proyectan los tipos temporales a las dimensiones de valor/espacio y/o tiempo. Esto filtrará las tuplas con un índice como se muestra en la siguiente consulta.
			</p><pre class="programlisting">
SELECT atTime(T.Trip, tstzspan '[2001-01-01, 2001-01-02)')
FROM Trips T
-- Filtro de índice con cuadro delimitador
WHERE T.Trip &amp;&amp; tstzspan '[2001-01-01, 2001-01-02)';
</pre><p>
		</p><p>En el caso de los puntos temporales, todas las relaciones espaciales con la semántica posible (ver la <a class="xref" href="ch08s07.html" title="Relaciones espaciales">“Relaciones espaciales”</a>) incluyen automáticamente una comparación de cuadro delimitador que hará uso de cualquier índice que esté disponible en los puntos temporales. Por esta razón, la primera versión de las relaciones se usa típicamente para filtrar las tuplas con la ayuda de un índice al calcular las relaciones temporales como se muestra en la siguiente consulta.
			</p><pre class="programlisting">
SELECT tintersects(T.Trip, R.Geom)
FROM Trips T, Regions R
-- Filtro de índice con cuadro delimitador
WHERE intersects(T.Trip, R.Geom);
</pre><p>
		</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch10.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="ch10.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="ch10s03.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Capítulo 10. Tipos temporales: Agregación e indexación </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> Estadísticas y selectividad</td></tr></table></div></body></html>
