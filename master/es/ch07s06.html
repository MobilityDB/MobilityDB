<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Transformaciones</title><link rel="stylesheet" type="text/css" href="docbook.css"><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><link rel="home" href="index.html" title="MobilityDB 1.3 Manual de usuario"><link rel="up" href="ch07.html" title="Capítulo 7. Tipos temporales geométricos (Parte 1)"><link rel="prev" href="ch07s05.html" title="Accessores"><link rel="next" href="ch08.html" title="Capítulo 8. Tipos temporales geométricos (Parte 2)"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Transformaciones</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch07s05.html">Anterior</a> </td><th width="60%" align="center">Capítulo 7. Tipos temporales geométricos (Parte 1)</th><td width="20%" align="right"> <a accesskey="n" href="ch08.html">Siguiente</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tgeo_transformations"></a>Transformaciones</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a name="tspatial_round"></a><a class="indexterm" name="id5191"></a><p>Redondear los valores de las coordenadas a un número de decimales <span class="inlinemediaobject"><img src="../images/cube.svg" width="13"></span>
 <span class="inlinemediaobject"><img src="../images/world.svg" width="13"></span>
</p><p><code class="varname">round(tspatial,integer=0) → tgeo</code></p><pre class="programlisting">
SELECT asText(round(tgeompoint '{Point(1.12345 1.12345 1.12345)@2001-01-01,
  Point(2 2 2)@2001-01-02, Point(1.12345 1.12345 1.12345)@2001-01-03}', 2));
/* {POINT Z (1.12 1.12 1.12)@2001-01-01, POINT Z (2 2 2)@2001-01-02,
   POINT Z (1.12 1.12 1.12)@2001-01-03} */
SELECT asText(round(tgeography 'Linestring(1.12345 1.12345,2.12345 2.12345)@2001-01-01', 2));
-- LINESTRING(1.12 1.12,2.12 2.12)@2001-01-01
</pre></li><li class="listitem"><a name="tpoint_makeSimple"></a><a class="indexterm" name="id5213"></a><p>Devuelve una matriz de fragmentos del punto temporal que son simples <span class="inlinemediaobject"><img src="../images/cube.svg" width="13"></span>
</p><p><code class="varname">makeSimple(tpoint) → tgeompoint[]</code></p><pre class="programlisting">
SELECT asText(makeSimple(tgeompoint '[Point(0 0)@2001-01-01, Point(1 1)@2001-01-02,
  Point(0 0)@2001-01-03]'));
/* {"[POINT(0 0)@2001-01-01, POINT(1 1)@2001-01-02)",
   "[POINT(1 1)@2001-01-02, POINT(0 0)@2001-01-03]"} */
SELECT asText(makeSimple(tgeompoint '[Point(0 0 0)@2001-01-01, Point(1 1 1)@2001-01-02,
  Point(2 0 2)@2001-01-03, Point(0 0 0)@2001-01-04]'));
/* {"[POINT Z (0 0 0)@2001-01-01, POINT Z (1 1 1)@2001-01-02, POINT Z (2 0 2)@2001-01-03,
   POINT Z (0 0 0)@2001-01-04]"} */
SELECT asText(makeSimple(tgeompoint '[Point(0 0)@2001-01-01, Point(1 1)@2001-01-02,
  Point(0 1)@2001-01-03, Point(1 0)@2001-01-04]'));
/* {"[POINT(0 0)@2001-01-01, POINT(1 1)@2001-01-02, POINT(0 1)@2001-01-03)",
    "[POINT(0 1)@2001-01-03, POINT(1 0)@2001-01-04]"} */
SELECT asText(makeSimple(tgeompoint '{[Point(0 0 0)@2001-01-01, Point(1 1 1)@2001-01-02],
  [Point(1 1 1)@2001-01-03, Point(0 0 0)@2001-01-04]}'));
/* {"{[POINT Z (0 0 0)@2001-01-01, POINT Z (1 1 1)@2001-01-02],
   [POINT Z (1 1 1)@2001-01-03, POINT Z (0 0 0)@2001-01-04]}"} */
</pre></li><li class="listitem"><a name="tgeo_geoMeasure"></a><a class="indexterm" name="id5228"></a><p>Construir una geometría/geografía con medida M a partir de un punto temporal y un número flotante temporal <span class="inlinemediaobject"><img src="../images/cube.svg" width="13"></span>
 <span class="inlinemediaobject"><img src="../images/world.svg" width="13"></span>
</p><p><code class="varname">geoMeasure(tpoint,tfloat,segmentize=false) → geo</code></p><p>El último argumento <code class="varname">segmentize</code> establece si el valor resultado ya sea es un <code class="varname">Linestring M</code> o un <code class="varname">MultiLinestring M</code> donde cada componente es un segmento de dos puntos.</p><pre class="programlisting">
SELECT ST_AsText(geoMeasure(tgeompoint '{Point(1 1 1)@2001-01-01,
  Point(2 2 2)@2001-01-02}', '{5@2001-01-01, 5@2001-01-02}'));
-- MULTIPOINT ZM (1 1 1 5,2 2 2 5)
SELECT ST_AsText(geoMeasure(tgeogpoint '{[Point(1 1)@2001-01-01, Point(2 2)@2001-01-02],
  [Point(1 1)@2001-01-03, Point(1 1)@2001-01-04]}',
  '{[5@2001-01-01, 5@2001-01-02],[7@2001-01-03, 7@2001-01-04]}'));
-- GEOMETRYCOLLECTION M (POINT M (1 1 7),LINESTRING M (1 1 5,2 2 5))
SELECT ST_AsText(geoMeasure(tgeompoint '[Point(1 1)@2001-01-01,
  Point(2 2)@2001-01-02, Point(1 1)@2001-01-03]',
  '[5@2001-01-01, 7@2001-01-02, 5@2001-01-03]', true));
-- MULTILINESTRING M ((1 1 5,2 2 5),(2 2 7,1 1 7))
</pre><p>Una visualización típica de los datos de movilidad es mostrar en un mapa la trayectoria del objeto móvil utilizando diferentes colores según la velocidad. La <a class="xref" href="ch07s06.html#figspeed" title="Figura 7.2. Visualización de la velocidad de un objeto móvil usando una rampa de color en QGIS.">Figura 7.2, “Visualización de la velocidad de un objeto móvil usando una rampa de color en QGIS.”</a> muestra el resultado de la consulta a continuación usando una rampa de color en QGIS.</p><pre class="programlisting">
WITH Temp(t) AS (
  SELECT tgeompoint '[Point(0 0)@2001-01-01, Point(1 1)@2001-01-05,
    Point(2 0)@2001-01-08, Point(3 1)@2001-01-10, Point(4 0)@2001-01-11]' )
SELECT ST_AsText(geoMeasure(t, round(speed(t) * 3600 * 24, 2), true))
FROM Temp;
/* MULTILINESTRING M ((0 0 0.35,1 1 0.35),(1 1 0.47,2 0 0.47),(2 0 0.71,3 1 0.71),
  (3 1 1.41,4 0 1.41)) */
</pre><p>La siguiente expresión se usa en QGIS para lograr esto. La función <code class="varname">scale_linear</code> transforma el valor M de cada segmento componente al rango [0, 1]. Este valor luego se pasa a la función <code class="varname">ramp_color</code>.</p><pre class="programlisting">
ramp_color('RdYlBu', scale_linear(
    m(start_point(geometry_n($geometry,@geometry_part_num))),
      0, 2, 0, 1) )
</pre><div class="figure-float"><div class="figure"><a name="figspeed"></a><p class="title"><b>Figura 7.2. Visualización de la velocidad de un objeto móvil usando una rampa de color en QGIS.</b></p><div class="figure-contents"><div class="mediaobject"><img src="../images/speed.png" width="162" alt="Visualización de la velocidad de un objeto móvil usando una rampa de color en QGIS."></div></div></div><br class="figure-break"></div></li><li class="listitem"><a name="tgeo_affine"></a><a class="indexterm" name="id5266"></a><p>Devuelve la transformación afín 3D de una geometría temporal para traducirla, rotarla y/o escalarla en un solo paso <span class="inlinemediaobject"><img src="../images/cube.svg" width="13"></span>
</p><p><code class="varname">affine(tgeo,float a,float b,float c,float d,float e,float f,float g,</code></p><p><code class="varname">  float h,float i,float xoff,float yoff,float zoff) → tgeo</code></p><p><code class="varname">affine(tgeo,float a,float b,float d,float e,float xoff,float yoff) → tgeo</code></p><pre class="programlisting">
-- Rotate a 3D temporal point 180 degrees about the z axis
SELECT asEWKT(affine(temp, cos(pi()), -sin(pi()), 0, sin(pi()), cos(pi()), 0, 0, 0, 1,
  0, 0, 0))
FROM (SELECT tgeompoint '[POINT(1 2 3)@2001-01-01, POINT(1 4 3)@2001-01-02]' AS temp) t;
-- [POINT Z (-1 -2 3)@2001-01-01, POINT Z (-1 -4 3)@2001-01-02]
SELECT asEWKT(rotate(temp, pi()))
FROM (SELECT tgeompoint '[POINT(1 2 3)@2001-01-01, POINT(1 4 3)@2001-01-02]' AS temp) t;
-- [POINT Z (-1 -2 3)@2001-01-01, POINT Z (-1 -4 3)@2001-01-02]
-- Rotate a 3D temporal point 180 degrees in both the x and z axis
SELECT asEWKT(affine(temp, cos(pi()), -sin(pi()), 0, sin(pi()), cos(pi()), -sin(pi()), 
   0, sin(pi()), cos(pi()), 0, 0, 0))
FROM (SELECT tgeometry '[Point(1 1)@2001-01-01, 
  Linestring(1 1,2 2)@2001-01-02]' AS temp) t;
-- [POINT(-1 -1)@2001-01-01, LINESTRING(-1 -1,-2 -2)@2001-01-02]
</pre></li><li class="listitem"><a name="tgeo_rotate"></a><a class="indexterm" name="id5285"></a><p>Devuelve el punto temporal rotado en sentido antihorario sobre el punto de origen</p><p><code class="varname">rotate(tgeo,float radians) → tgeo</code></p><p><code class="varname">rotate(tgeo,float radians,float x0,float y0) → tgeo</code></p><p><code class="varname">rotate(tgeo,float radians,geometry pointOrigin) → tgeo</code></p><pre class="programlisting">
-- Rotate a temporal point 180 degrees
SELECT asEWKT(rotate(tgeompoint '[Point(5 10)@2001-01-01, Point(5 5)@2001-01-02, 
  Point(10 5)@2001-01-03]', pi()), 6);
-- [POINT(-5 -10)@2001-01-01, POINT(-5 -5)@2001-01-02, POINT(-10 -5)@2001-01-03]
-- Rotate 30 degrees counter-clockwise at x=5, y=10
SELECT asEWKT(rotate(tgeompoint '[Point(5 10)@2001-01-01, Point(5 5)@2001-01-02, 
  Point(10 5)@2001-01-03]', pi()/6, 5, 10), 6);
-- [POINT(5 10)@2001-01-01, POINT(7.5 5.67)@2001-01-02, POINT(11.83 8.17)@2001-01-03]
-- Rotate 60 degrees clockwise from centroid
SELECT asEWKT(rotate(temp, -pi()/3, ST_Centroid(traversedArea(temp))), 2)
FROM (SELECT tgeometry '[Point(5 10)@2001-01-01, Point(5 5)@2001-01-02, 
  Linestring(5 5,10 5)@2001-01-03]' AS temp) AS t;
/* [POINT(10.58 9.67)@2001-01-01, POINT(6.25 7.17)@2001-01-02, 
    LINESTRING(6.25 7.17,8.75 2.83)@2001-01-03] */
</pre></li><li class="listitem"><a name="tgeo_scale"></a><a class="indexterm" name="id5297"></a><p>Devuelve un punto temporal escalado por factores dados <span class="inlinemediaobject"><img src="../images/cube.svg" width="13"></span>
</p><p><code class="varname">scale(tgeo,float Xfactor,float Yfactor,float Zfactor) → tgeo</code></p><p><code class="varname">scale(tgeo,float Xfactor,float Yfactor) → tgeo</code></p><p><code class="varname">scale(tgeo,geometry factor) → tgeo</code></p><p><code class="varname">scale(tgeo,geometry factor,geometry origin) → tgeo</code></p><pre class="programlisting">
SELECT asEWKT(scale(tgeompoint '[Point(1 2 3)@2001-01-01, Point(1 1 1)@2001-01-02]', 
  0.5, 0.75, 0.8));
--  [POINT Z (0.5 1.5 2.4)@2001-01-01, POINT Z (0.5 0.75 0.8)@2001-01-02]
SELECT asEWKT(scale(tgeompoint '[Point(1 2 3)@2001-01-01, Point(1 1 1)@2001-01-02]', 
  0.5, 0.75));
-- [POINT Z (0.5 1.5 3)@2001-01-01, POINT Z (0.5 0.75 1)@2001-01-02]
SELECT asEWKT(scale(tgeompoint '[Point(1 2 3)@2001-01-01, Point(1 1 1)@2001-01-02]', 
  geometry 'Point(0.5 0.75 0.8)'));
-- [POINT Z (0.5 1.5 2.4)@2001-01-01, POINT Z (0.5 0.75 0.8)@2001-01-02]
SELECT asEWKT(scale(tgeometry '[Point(1 1)@2001-01-01, Linestring(1 1,2 2)@2001-01-02]',
  geometry 'Point(2 2)', geometry 'Point(1 1)'));
-- [POINT(1 1)@2001-01-01, LINESTRING(1 1,3 3)@2001-01-02]
</pre></li><li class="listitem"><a name="tpoint_asMVTGeom"></a><a class="indexterm" name="id5318"></a><p>Transformar un punto geométrico temporal en el espacio de coordenadas de un Mapbox Vector Tile <span class="inlinemediaobject"><img src="../images/cube.svg" width="13"></span>
</p><p><code class="varname">asMVTGeom(tpoint,bounds,extent=4096,buffer=256,clip=true) → (geom,times)</code></p><p>El resultado es un par compuesto de un valor <code class="varname">geometry</code> y una matriz de valores de marca de tiempo asociados codificados como época de Unix. Los parámetros son los siguientes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">tpoint</code> es el punto temporal para transformar</p></li><li class="listitem"><p><code class="varname">bounds</code> es un <code class="varname">stbox</code> que define los límites geométricos del contenido del mosaico sin búfer</p></li><li class="listitem"><p><code class="varname">extent</code> es la extensión del mosaico en el espacio de coordenadas del mosaico</p></li><li class="listitem"><p><code class="varname">buffer</code> es la distancia del búfer en el espacio de coordenadas de mosaico</p></li><li class="listitem"><p><code class="varname">clip</code> es un booleano que determina si las geometrías resultantes y las marcas de tiempo deben recortarse o no</p></li></ul></div><pre class="programlisting">
SELECT ST_AsText((mvt).geom), (mvt).times
FROM (SELECT asMVTGeom(tgeompoint '[Point(0 0)@2001-01-01, Point(100 100)@2001-01-02]',
  stbox 'STBOX X((40,40),(60,60))') AS mvt ) AS t;
-- LINESTRING(-256 4352,4352 -256) | {946714680,946734120}
SELECT ST_AsText((mvt).geom), (mvt).times
FROM (SELECT asMVTGeom(tgeompoint '[Point(0 0)@2001-01-01, Point(100 100)@2001-01-02]',
  stbox 'STBOX X((40,40),(60,60))', clip:=false) AS mvt ) AS t;
-- LINESTRING(-8192 12288,12288 -8192) | {946681200,946767600}
</pre></li><li class="listitem"><a name="tgeo_stops"></a><a class="indexterm" name="id5352"></a><p>Extraer de un punto de geometría temporal con interpolación lineal las subsecuencias donde el punto permanece dentro de un área con un tamaño máximo especificado durante al menos la duración dada <span class="inlinemediaobject"><img src="../images/cube.svg" width="13"></span>
 <span class="inlinemediaobject"><img src="../images/world.svg" width="13"></span>
</p><p><code class="varname">stops(tgeompoint,maxDist=0.0,minDuration='0 minutes') → tgeompoint</code></p><p>El tamaño del área se calcula como la diagonal del rectángulo mínimo rotado de los puntos de la subsecuencia. Si no se especifica <code class="varname">maxDist</code>, se asume 0.0 y, por lo tanto, la función extrae los segmentos constantes del punto temporal dado. La distancia se calcula en las unidades del sistema de coordenadas. Tenga en cuenta que, aunque la función acepta geometrías 3D, el cálculo siempre se realiza en 2D.</p><pre class="programlisting">
SELECT asText(stops(tgeompoint '[Point(1 1)@2001-01-01, Point(1 1)@2001-01-02,
  Point(2 2)@2001-01-03, Point(2 2)@2001-01-04]'));
/* {[POINT(1 1)@2001-01-01, POINT(1 1)@2001-01-02), [POINT(2 2)@2001-01-03,
   POINT(2 2)@2001-01-04]} */
SELECT asText(stops(tgeompoint '[Point(1 1 1)@2001-01-01, Point(1 1 1)@2001-01-02,
  Point(2 2 2)@2001-01-03, Point(2 2 2)@2001-01-04]', 1.75));
/* {[POINT Z (1 1 1)@2001-01-01, POINT Z (1 1 1)@2001-01-02, POINT Z (2 2 2)@2001-01-03,
   POINT Z (2 2 2)@2001-01-04]} */
</pre></li></ul></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch07s05.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="ch07.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="ch08.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Accessores </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> Capítulo 8. Tipos temporales geométricos (Parte 2)</td></tr></table></div></body></html>
