<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Statistics and Selectivity</title><link rel="stylesheet" type="text/css" href="docbook.css"><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><link rel="home" href="index.html" title="MobilityDB 1.2 User's Manual"><link rel="up" href="ch10.html" title="Chapter 10. Temporal Types: Aggregation and Indexing"><link rel="prev" href="ch10s02.html" title="Indexing"><link rel="next" href="ch11.html" title="Chapter 11. Temporal Network Points"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Statistics and Selectivity</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch10s02.html">Prev</a> </td><th width="60%" align="center">Chapter 10. Temporal Types: Aggregation and Indexing</th><td width="20%" align="right"> <a accesskey="n" href="ch11.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="temporal_types_statistics"></a>Statistics and Selectivity</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm6240"></a>Statistics Collection</h3></div></div></div><p>The PostgreSQL planner relies on statistical information about the contents of tables in order to generate the most efficient execution plan for queries. These statistics include a list of some of the most common values in each column and a histogram showing the approximate data distribution in each column. For large tables, a random sample of the table contents is taken, rather than examining every row. This enables large tables to be analyzed in a small amount of time. The statistical information is gathered by the <code class="varname">ANALYZE</code> command and stored in the <code class="varname">pg_statistic</code> catalog table. Since different kinds of statistics may be appropriate for different kinds of data, the table only stores very general statistics (such as number of null values) in dedicated columns. Everything else is stored in five “slots”, which are couples of array columns that store the statistics for a column of an arbitrary type.</p><p>The statistics collected for time types and temporal types are based on those collected by PostgreSQL for scalar types and span types. For scalar types, such as <code class="varname">float</code>, the following statistics are collected:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>fraction of null values,</p></li><li class="listitem"><p>average width, in bytes, of non-null values,</p></li><li class="listitem"><p>number of different non-null values,</p></li><li class="listitem"><p>array of most common values and array of their frequencies,</p></li><li class="listitem"><p>histogram of values, where the most common values are excluded,</p></li><li class="listitem"><p>correlation between physical and logical row ordering.</p></li></ol></div><p>
			</p><p>For span types, like <code class="varname">tstzspan</code>, three additional histograms are collected:
				</p><div class="orderedlist"><ol class="orderedlist" start="7" type="1"><li class="listitem"><p>length histogram of non-empty spans,</p></li><li class="listitem"><p>histograms of lower and upper bounds.</p></li></ol></div><p>
			</p><p>For geometries, in addition to (1)–(3), the following statistics are collected:
				</p><div class="orderedlist"><ol class="orderedlist" start="9" type="1"><li class="listitem"><p>number of dimensions of the values, N-dimensional bounding box, number of rows in the table, number of rows in the sample, number of non-null values,</p></li><li class="listitem"><p>N-dimensional histogram that divides the bounding box into a number of cells and keeps the proportion of values that intersects with each cell.</p></li></ol></div><p>
			</p><p>The statistics collected for columns of the time and span types <code class="varname">tstzset</code>, <code class="varname">tstzspan</code>, <code class="varname">tstzspanset</code>, <code class="varname">intspan</code>, and <code class="varname">floatspan</code> replicate those collected by PostgreSQL for the <code class="varname">tstzrange</code>. This is clear for the span types in MobilityDB, which are more efficient versions of the range types in PostgreSQL. For the <code class="varname">tstzset</code> and the <code class="varname">tstzspanset</code> types, a value is converted into its bounding period, then the statistics for the <code class="varname">tstzspan</code> type are collected.</p><p>The statistics collected for columns of temporal types depend on their subtype and their base type. In addition to statistics (1)–(3) that are collected for all temporal types, statistics are collected for the time and the value dimensions independently. More precisely, the following statistics are collected for the time dimension:
				</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>For columns of instant subtype, the statistics (4)–(6) are collected for the timestamps.</p></li><li class="listitem"><p>For columns of other subtype, the statistics (7)–(8) are collected for the (bounding box) periods.</p></li></ul></div><p>
			</p><p>The following statistics are collected for the value dimension:
				</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>For columns of temporal types with step interpolation (that is, <code class="varname">tbool</code>, <code class="varname">ttext</code>, or <code class="varname">tint</code>):
							</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>For the instant subtype, the statistics (4)–(6) are collected for the values.</p></li><li class="listitem"><p>For all other subtypes, the statistics (7)–(8) are collected for the values.</p></li></ul></div><p>
						</p></li><li class="listitem"><p>For columns of the temporal float type (that is, <code class="varname">tfloat</code>):
							</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>For the instant subtype, the statistics (4)–(6) are collected for the values.</p></li><li class="listitem"><p>For all other subtype, the statistics (7)–(8) are collected for the (bounding) value spans.</p></li></ul></div><p>
						</p></li><li class="listitem"><p>For columns of temporal point types (that is, <code class="varname">tgeompoint</code> and <code class="varname">tgeogpoint</code>) the statistics (9)–(10) are collected for the points.</p></li></ul></div><p>
			</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm6313"></a>Selectivity Estimation</h3></div></div></div><p>Boolean operators in PostgreSQL can be associated with two selectivity functions, which compute how likely a value of a given type will match a given criterion. These selectivity functions rely on the statistics collected. There are two types of selectivity functions. The <span class="emphasis"><em>restriction</em></span> selectivity functions try to estimate the percentage of the rows in a table that satisfy a <code class="varname">WHERE</code>-clause condition of the form <code class="varname">column OP constant</code>. On the other hand, the <span class="emphasis"><em>join</em></span> selectivity functions try to estimate the percentage of the rows in a table that satisfy a <code class="varname">WHERE</code>-clause condition of the form <code class="varname">table1.column1 OP table2.column2</code>.</p><p>MobilityDB defines 23 classes of Boolean operators (such as <code class="varname">=</code>, <code class="varname">&lt;</code>, <code class="varname">&amp;&amp;</code>, <code class="varname">&lt;&lt;</code>, etc.), each of which can have as left or right arguments a PostgreSQL type (such as <code class="varname">integer</code>, <code class="varname">timestamptz</code>, etc.) or a MobilityDB type (such as <code class="varname">tstzspan</code>, <code class="varname">tint</code>, etc.). As a consequence, there is a very high number of operators with different arguments to be considered for the selectivity functions. The approach taken was to group these combinations into classes corresponding to the value and time dimensions. The classes correspond to the type of statistics collected as explained in the previous section.</p><p>MobilityDB estimates both restriction and join selectivity for time, span, and temporal types.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch10s02.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch10.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch11.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Indexing </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 11. Temporal Network Points</td></tr></table></div></body></html>
